<!DOCTYPE html>
<html>
<head>
  <title>Hello</title>
  <script type="text/javascript" src="assets/javascripts/react.js"></script>
  <script type="text/javascript" src="assets/javascripts/JSXTransformer.js"></script>
  <link rel="stylesheet" type="text/css" href="assets/stylesheets/boxcard.css"/>
  <!--script type="text/javascript" src="assets/javascripts/boxcard.js"></script-->
</head>
<body>

  <div id="content">
    <h1>BoxCard</h1>
    <div id="cards"></div>
  </div>
  <script type="text/jsx">
  (function() {

    var fight = {
      id: 123,
      weight: 'Welterweight',
      catchWeight: false,
      rounds: 12,
      location: 'MGM Grand, Las Vegas, NV',
      date: new Date(Date.UTC(2015, 4, 2)),
      fighters: [
        {
          name: 'Floyd Mayweather',
          id: 1,
          key: 1,
          record: {
            wins: 48,
            losses: 0,
            draws: 0
          }
        },
        {
          name: 'Manny Pacquiao',
          id: 2,
          key: 2,
          record: {
            wins: 45,
            losses: 3,
            draws: 1
          }
        }
      ]
    }

    var Card = React.createClass({
      getInitialState: function() {
        return {
          scores: this.props.fighters.reduce(function(memo, fighter) {
            memo[fighter.id] = [10, 10, 9, 8];
            return memo;
          }, {})
        }
      },
      render: function(){
        return (
          <div className="card">
            <CardHeader {...this.props}/>
            <Scores {...this.props} scores={this.state.scores}/>
            <ScorePad {...this.props}/>
          </div>
        )
      }
    });

    var CardHeader = React.createClass({
      render: function(){
        var fighters = this.props.fighters.map(function(fighter) {
          return <Fighter {...fighter} />
        });
        return (
          <div className="card-header">
            <h2>{ fighters }</h2>
            <h3>{ this.props.location}, { this.props.date.toString() }</h3>
          </div>
        );
      }
    });

    var Scores = React.createClass({
      render: function() {
        var rounds = [];
        for (var i = 1; i <= this.props.rounds; i++) {
          rounds.push(<td key={i}>{i}</td>);
        };
        return (
          <table className="scores">
            <thead>
              <tr>
                <td>Fighter</td>
                { rounds }
              </tr>
            </thead>
            <tbody>
              {this.props.fighters.map(function(fighter) {
                return (<FighterScores key={fighter.key} fighter={fighter} rounds={this.props.rounds} scores={this.props.scores[fighter.key]}/>);
              }, this)}
            </tbody>
          </table>
        );
      }
    });

    var FighterScores = React.createClass({
      render: function() {
        var rounds = [];
        for (var i = 1; i <= this.props.rounds; i++) {
          rounds.push(<FighterRound key={i} score={this.props.scores[i - 1]}/>);
        };
        return (
          <tr className="fighter-round">
            <td>{ this.props.fighter.name }</td>
            { rounds }
          </tr>
        );
      }
    });

    var FighterRound = React.createClass({
      render: function() {
        return (<td>{ this.props.score }</td>);
      }
    });

    var Fighter = React.createClass({
      render: function() {
        return (
          <div className="fighter">
            <strong className="fighter-name">{this.props.name}</strong>
            <span className="fighter-record">({this.props.record.wins}-{this.props.record.losses}-{this.props.record.draws})</span>
          </div>
        )
      }
    });

    var ScorePad = React.createClass({
      updateScore: function(e) {
        console.log('update?');
        console.log(e.target.value);
        // this.setState({})
      },
      render: function() {
        return (
          <form className="score-pad">
            <label>Round</label>
            <input type="text" name="round"/>
            { this.props.fighters.map(function(fighter) {
              return (
                <fieldset key={fighter.id}>
                  <label>{ fighter.name }</label>
                  <input type="text" onChange={this.updateScore} />
                </fieldset>
              )
            })}
          </form>
        );
      }
    })

    React.render(
      <Card {...fight}/>,
      document.getElementById('cards')
    );

  })();
  </script>

</body>
</html>